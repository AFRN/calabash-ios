## 0.10.0 changelog

### before 0.10.0 release

in order of priority 

*** required ***

- [x] @krukow update README.md around 'frank' branch (see: https://github.com/calabash/calabash-ios/commit/3699f2e63b43bb961dbde3c35fd57da8936bdbfd, https://github.com/calabash/calabash-ios-server/commit/028779e477368cc7b8dba235b5e5b6b51b5b11f8)
- [x] @krukow add frank updates to this changelog - include http://screencast.com/t/hBtcdwzelfO link?
- [x] @krukow update this changelog RE: visibility heuristic changes
- [x] @krukow experimental dylib support
- [x] @krukow frank on-device support
- [ ] @jmoody first pass at documenting the environmental variables
- [ ] @jmoody remove the README_YARDOC from the yard index

### Features

#### Experimental dylib support

Currently Calabash iOS requires statically linking in the `calabash.framework`. This requires a re-build of the project and typically involves maintaining a separate target (although other options exist like the Xamarin component or http://intuit-engineering.com/?p=44). This release brings experimental support for dynamically loading the Calabash server at runtime (via a dynamic library). 

The benefits are clear: (1) you can take any .app bundle (or .ipa) even if not linked with Calabash and simply load the Calabash server at run-time without having to re-compile the project; (2) the Calabash server and client won't get out of sync; and (3) not setup or change to Xcode or Xamarin Studio project is needed, nor is using a Xamarin Component in Visual Studio or Xamarin studio. 

Here is a demo:

http://www.screencast.com/t/YDN15tZ8El

The reason this is still considered experimental is that we have not investigated the stability of the solution. 

To try it out, use the simulator (as on-device is more complicated). Use a "vanilla" app-bundle that is *not* linked with the Calabash server and use  `start_test_server_in_background(inject_dylib: true)` or use the `relaunch` method with `inject_dylib: true`.

We will spend time evaluating the viability of this approach going forward.

#### Frank Calabash plugin 

This release brings alpha support for running Calabash iOS as a plugin-to Frank. This for Frank users that would like to also take advantage of Calabash features like: full Calabash API (see below), extended ([Query syntax support](http://developer.xamarin.com/guides/testcloud/calabash/calabash-query-syntax/)), ([Web-View support](http://developer.xamarin.com/guides/testcloud/calabash/calabash-query-syntax/#DOM_WebView Support)) and [On-device testing](https://github.com/calabash/calabash-ios/wiki/07-Testing-on-physical-iDevices). 

To install the Frank-Calabash plugin, make sure you're using Frank 1.2.3 or above and Calabash iOS version 0.10.0 or above. In your Frank project run the command `frank-calabash install` - this will copy `libFrankCalabash.a` to your `Frank/plugins/calabash` folder. Use `frank-calabash uninstall` to remove it again. Remember to `frank build` again after adding/removing the plugin.

We've updated the README.md of https://github.com/calabash/calabash-ios-example to include instructions.

To try out the plugin you run `frank-calabash console` as demonstrated in the informal screencast: 

http://screencast.com/t/hBtcdwzelfO

Note: to use this in a cucumber test, you must modify your test scripts (often your hooks) to let Calabash launch the app using instruments. Using Frank's sim_launcher doesn't work as Calabash relies on Apple's "public" UIAutomation launched with instruments. The appropriate require's needed are

```ruby
require 'frank-calabash'
require 'calabash-cucumber/operations'
```

You can then `include` the `Frank::Calabash` module which provides two important methods: `launch` to launch using instruments (see: http://calabashapi.xamarin.com/ios/Calabash/Cucumber/Launcher.html#relaunch-instance_method) and `calabash_client` which provides an object with the Calabash operations mixed in (most importantly http://calabashapi.xamarin.com/ios/Calabash/Cucumber/Core.html).

Feedback is very welcome: Use https://groups.google.com/forum/?fromgroups=#!forum/calabash-ios or https://groups.google.com/forum/?fromgroups=#!forum/frank-discuss 

Note: it is possible to run Frank-Calabash on-device. It requires some manual work as Frank doesn't support building the Frankified app for device yet.

This is a sample that worked for the sample project: https://github.com/calabash/calabash-ios-example 

First, make sure you've run `frank setup`, `frank-calabash install` and `frank build` and that it works. 

Now 
```
xcrun xcodebuild -xcconfig Frank/frank.xcconfig clean build  -arch armv7s -configuration Debug -sdk iphoneos ONLY_ACTIVE_ARCH=NO DEPLOYMENT_LOCATION=YES DSTROOT="/Users/krukow/code/calabash-ios-example/Frank/frankified_build" FRANK_LIBRARY_SEARCH_PATHS="\"/Users/krukow/code/calabash-ios-example/Frank\" \"/Users/krukow/code/calabash-ios-example/Frank/plugins/calabash\""
```

Package:
```
xcrun -sdk iphoneos PackageApplication -v /Users/krukow/code/calabash-ios-example/Frank/frankified_build/LPSimpleExample.app -o `pwd`/"frank.ipa"
```

(optional resign the ipa)

In the `frank-calabash console` use: 

```
launch(app:'com.lesspainful.example.LPSimpleExample', device_target:'device')
```

notice that with the regular touch command, e.g., 

```
touch("view marked:'Second'")

#we get this in the device log: backboardd[31] <Error>: HID: Error: the client 'LPSimpleExample' is missing the 'com.apple.private.hid.client.event-dispatch' entitlement.
```

but with 

```
c = calabash_client
c.touch("* marked:'Second'")
```

The touch works on-device.


#### yard

The public API has been 100% documented.  [1]

See README_YARD.md [2] for details about how to document and how to generate docs locally.

Thank you @joelmartinez!

- [1] http://calabashapi.xamarin.com/ios/
- [2] README_YARD.md http://git.io/UzumZA

#### travis-ci

The rspec, unit tests, and cucumbers are now running in travis-ci. [1]

- [1] https://travis-ci.org/calabash/calabash-ios

### Changes

#### Validate and log UIAChannel communication

A stability improvement which logs UIA actions via the UIAChannel in Calabash server. Should be transparent to most users.

### Fixes

#### Improved Visibility Heuristic

Fixes visibility in cases where a transparent view completely overlaps a non-control (e.g. UILabel).  Previously, calabash would consider this view invisible. See: https://github.com/calabash/calabash-ios-server/pull/50

#### Resetting App and Simulator Content & Settings

Fixed a bug in `reset_app_jail`; only the sandbox of the most recent SDK was reset.

* In addition, `reset_app_jail` has been deprecated.  It has been replaced by `reset_app_sandbox`.
* Added `Calabash::Cucumber::Launcher.reset_simulator` for simulating touching the iOS Simulator > Reset Simulator Content and Settings... Menu Item.

Thanks to @nemesis for reporting [issue 376](https://github.com/calabash/calabash-ios/issues/376).

#### Other

- [commit 4d95fc0](https://github.com/calabash/calabash-ios/commit/4d95fc04e34e534d4b745a202514679067d8cc0f) bad edn dependency
- [pull 419](https://github.com/calabash/calabash-ios/pull/419) Readme: Link to Guide for Setup with Custom Build Configuration; thanks @fabb
- [pull 428](https://github.com/calabash/calabash-ios/pull/428) Then I touch right and down from "..."; thanks @crishoj
- [pull 441](https://github.com/calabash/calabash-ios/pull/441) README.md should show the CI/License badges; thanks @staxmanade
- [pull 384](https://github.com/calabash/calabash-ios/pull/384) - call to `strings` in gem/server compatibility should work on paths with spaces; thanks @Sqeaky


### Special Thanks

* @crishoj for helping test the 'minitest' fixes [pull 395](https://github.com/calabash/calabash-ios/pull/395).
* everyone who waited patiently for the ruby-zip update

### Deprecated

See https://github.com/calabash/calabash-ios/wiki/Deprecated

##### NEW

* since 0.10.0 `Calabash::Cucumber::Device.udid` - no replacement
* since 0.10.0 `tap` - replaced with `tap_mark`
* since 0.10.0 in `Calabash::Cucumber::Launcher` `reset_app_jail` has been replaced with `reset_app_sandbox`. This method has been deprecated, but does not issue a warning.
* since 0.10.0 `done` - replaced with `tap_keyboard_action_key`. This method has been deprecated, but does not issue a warning.
* since 0.10.0 `xcode_bin_dir` - not replaced.

### Other

#### rspec testing for testing Calabash iOS gem

```
$ be rake spec
```
